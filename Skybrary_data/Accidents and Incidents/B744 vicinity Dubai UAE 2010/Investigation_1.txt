An Investigation was carried out by the Air Accident Investigation Sector of the UAE GCAA. The FDR and 2 hour CVR were recovered from the accident site and their data were successfully downloaded. The only occupants of the aircraft were the operating crew. The 48 year-old Captain had been with UPS for 15 years and had 11,200 total flying hours including 4053 hours on the accident aircraft type over the previous 5 years. Command time on type was 1218 hours. The 38 year-old First Officer been with UPS for 4 years and had 5549 flying hours of which just 77 were on the accident aircraft type. It was established that the flight, with the First Officer as PF, had been uneventful until a 'Fire Main Deck' Warning was annunciated 22 minutes after take off as the aircraft was reaching its cleared level, FL320 and shortly after crossing into the Bahrain FIR and transferring to Bahrain ACC. Three seconds later, the Captain announced that he would take over as PF and followed up by stating that they were going to return (to Dubai). He then advised ATC of the fire indication and that they needed to land as soon as possible. Doha, at 100nm and 10'o'clock relative, was offered but the Captain replied that he wished to return to Dubai and then declared an emergency. As part of the QRH response procedure, the 'Main Deck Cargo Fire Arm' switch was depressed, which shut down air conditioning packs 2 and 3 whilst pack 1 continued to supply preconditioned air to the upper deck. The effect of this, in the absence of any active fire suppression in Class E main deck cargo compartments, is to establish a pressure differential between the upper deck and the rest of the aircraft thus preventing smoke or fumes entering that part of the aircraft. Both pilots donned their oxygen masks but had initial interphone communication difficulty that was subsequently resolved. The aircraft was put into a right turn and a descent to FL280 was begun. Then, shortly after the crew rest area smoke detector had activated and less than 3 minutes after the fire warning, the Captain suddenly requested and was immediately approved for an immediate descent to 10,000 feet. The AP was then disengaged but the Captain had difficulty controlling the aircraft manually, specifically in pitch and re-engaged the AP which restored control. It was found that the only remaining air conditioning pack was no longer functioning and smoke began to enter the flight deck. The Captain called for the smoke shutter to be opened because of the smoke ingress and the crew succeeded in setting for an ILS approach to runway 12L at Dubai as the increasing smoke appeared to have rapidly made it impossible to see the instruments. Seven minutes after the fire warning with the cabin altitude at around 21000 feet, the Captain remarked on the high temperature in the flight deck and then almost immediately, his oxygen supply suddenly failed. The First